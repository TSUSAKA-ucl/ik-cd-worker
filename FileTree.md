# ロボット定義およびworker, WASMのためのディレクトリ構成
```
project/
├─ src/
│  ├─ app/
│  └─ lib/
├─ public/
│  ├─ agilex_piper/
│  │  ├─ link1.gltf
│  │  ├─  ┆
│  │  ├─ link6.gltf
│  │  ├─ shapes.json	<- Shape Models for collision detection. automatically generated.
│  │  └─ urdf.json	<- joint model for FK & IK. automatically generated from ROBOT.urdf
│  ├─ jaka_zu_5/
│  │  ├─ JAKA_Zu_5_BASE.gltf
│  │  ├─  ┆
│  │  ├─ AG-160-95-body.glb
│  │  ├─ shapes.json
│  │  └─ urdf.json
│  ├─ wasm/		<- files in this directory are automatically generated by emscripten
│  │  ├─ cd_module.js
│  │  ├─ cd_module.wasm
│  │  ├─ slrm_module.js
│  │  └─ slrm_module.wasm
│  └─ worker.js	<- automatically generated by binding with vite
├─ worker/		<- source codes bundled with Vite
│  ├─ ***.js <- the homebrew module files
│  └─ worker.js <- main loop 
├─ wasm/	<- source files and build directories for WASM
│  ├─ CMakeLists.txt	<- for Emscripten
│  ├─ build/
│  ├─ dist -> ../public/wasm/
│  ├─ moveit_jacobian/	<- ros2 package
│  │  ├─ package.xml	<- ros2 package declaration file
│  │  ├─ CMakeLists.txt	<- ros2 cmake file
│  │  ├─  ┆
│  │  └─ src/
│  ├─ gjk_worker/
│  │  ├─ CMakeLists.txt	<- for Emscripten, This also uses the src of moveit_jacobian
│  │  ├─ build/
│  │  ├─ dist -> ../dist/
│  │  ├─ nodejs/	<- scripts for testing
│  │  └─ src/
│  └─ external/
│     └─ eigen/
├─ vite.config.mjs
└─ README.md
```

1. `src/`の下はNext.jsでビルドされる対象
2. `public/`の下のファイルはNext.jsが触らないが、Next.jsのdevサーバーのルートパスと
   してアクセスできるため、最終的にブラウザ側で使用するものはここに置く
3. `public/ロボット名/`は、ロボットのレンダリング用のgltf, 幾何計算のURDF,
   衝突判定用のshapeなどが入る
4. `public/wasm/`は、emscriptenが生成したwasmとjsをそのまま入れる。このjsは
   バインド対象外。人が編集することは無い。簡易に使えるようにgitリポジトリにwasmも入れる
5. `public/worker.js`は、viteでバインドした結果で、実際にブラウザにロードされる
   workerのコード。人が編集することは無い。簡易に使えるようにgitリポジトリに入れる
6. `wasm/`は、emscripten用のソースコードおよびbuildコマンドと
   build用ワーキングディレクトリ。作業の容易化のため、ワーキングディレクトリ自体は
   gitリポジトリに入れるが中身は事実上空で管理しない
7. `wasm/CMakeLists.txt`は一つのworkerで使用するwasmを一つにまとめる用に想定
   されているが、現状は`slrm_module`専用
8. `wasm/dist`はemscriptenの出力先のsymlinkで、`CMakeLists.txt`を変えることなく
   Node.jsによるテスト等に対応するためsymlinkにしてある
9. `wasm/moveit_jacobian/` git submodule. 中身はros2パッケージだが
   別途`CMakeLists.txt`を用意すればemscriptenで`slrm_module`のWASMも生成できる
10. `wasm/gjk_worker/` git submodule. `cd_module`のWASM生成専用だが、単独で
	C++でテストを行うmain関数も入っている。`moveit_jacobian/src/*`も使用する。
	`slrm_module`と`cd_module`は、一つのemscripten bindingsを作成すれば一つの
	WASMにできるが、開発速度優先で現状は分けている
11. `wasm/external/` emscriptenが使用する外部(テンプレート)ライブラリを
	submoduleとしてcloneしてくる場所。現状Eigen3のみ
12. `vite.config.mjs` 出力ファイルの指定、バインドしないモジュールの明記、有害な
	コピーの抑止などのために、専用のconfigが必要。`worker.js`はモジュールで行くため
	`.mjs`にしている
13. `README.md`従来のREADMEをそのまま置いてある
